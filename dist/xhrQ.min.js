!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.xhrQ=t():e.xhrQ=t()}(self,(function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return c}});var r={method:"GET",success:function(e){},failure:function(e,t,r){},timeout:15e3};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i="GET",a="POST",u="application/json",s={retryDelay:1e4},c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({},s,t||{}),this.working=!1,this.reDispatch=setInterval(this.dispatch,1e4),this.queue={}}var t,c,p;return t=e,(c=[{key:"push",value:function(e,t,n){window.addEventListener("onbeforeunload",this.getIncompleteAlert);var o=function(e,t,n){var o=Object.assign({},r,n),i={publicProperties:{getId:function(){return i.privateProperties.id},getPacket:function(){return{id:i.privateProperties.id,method:i.privateProperties.method,url:i.privateProperties.url,data:i.privateProperties.data,success:i.privateProperties.success,failure:i.privateProperties.failure,timeout:i.privateProperties.timeout}},getRequest:function(){return i.privateProperties.xhr},setRequest:function(e){var t=e;t.onload=function(){return i.privateProperties.success(t)},t.onerror=function(){return i.privateProperties.failure(t,t.statusText,t.status)},i.privateProperties.xhr=t},abort:function(){i.privateProperties.xhr instanceof XMLHttpRequest&&(i.privateProperties.xhr.abort(),i.privateProperties.xhr=null)}},privateProperties:{method:o.method,id:Date.now()+String(Math.random()),url:e,data:t,success:o.success,failure:o.failure,xhr:null},staticProperties:{}};return i.publicProperties}(e,t,n);return this.queue[o.getId()]=o,this.dispatch(),o}},{key:"pushRequest",value:function(e){return this.queue[e.getId()]=e,this.dispatch(),e}},{key:"abort",value:function(e){if(!(e in this.queue))throw"Tried to abort Ajax call. ID (".concat(e,") does not exist.");this.queue[e].abort(),delete this.queue[e]}},{key:"dispatch",value:function(){var e=Object.keys(this.queue);!1===this.working&&e.length>0?(this.working=!0,this.ajaxPacket(this.queue[e[0]])):!1===this.working&&0===e.length&&this.disableUnloadListener()}},{key:"ajaxPacket",value:function(e){var t=this,r=e.getPacket(),o=r.id,s=r.data,c=r.url,p=r.method,f=r.timeout,l=r.success,d=r.failure,h=new XMLHttpRequest;switch(h.timeout=f,p){case a:!function(e,t,r){var o,i=e,s=null;if("string"==typeof r)o=r,function(e){if("string"!=typeof e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(r)&&(s=u);else if(r instanceof FormData)o=r;else{if("object"!==n(r))throw"Data did not match any of the required types (string|FormData|Object.<string, any>)\n".concat(r);try{o=JSON.stringify(r),s=u}catch(e){throw"Could not convert data into JSON\n".concat(r)}}if(null!==s){var c=document.characterSet||"UTF-8";i.setRequestHeader("Content-Type","".concat(s,";charset=").concat(c))}i.open(a,t),i.send(o)}(h,c,s);break;case"PUT":case"DELETE":break;case"GET":default:!function(e,t,r){var o=e,a=[];if("string"==typeof r)a.push(r);else{if("object"!==n(r))throw"Data did not match any of the required types (string|Object.<string, any>)\n".concat(r);Object.keys(r).map((function(e){var t=encodeURIComponent(e),n=encodeURIComponent(r[e]);a.push("".concat(t,"=").concat(n))}))}o.open(i,"".concat(t,"?").concat(a.join("&"))),o.send()}(h,c,s)}return h.onload=function(){delete t.queue[o],l(h),t.working=!1},h.ontimeout=function(){setTimeout((function(){t.ajaxPacket(e)}),t.options.retryDelay)},h.onabort=function(){delete t.queue[o],t.working=!1},h.onerror=function(){0==h.readyState?setTimeout((function(){o in t.queue?t.queue[o].req=t.ajaxPacket(e):t.dispatch()}),t.options.retryDelay):(delete t.queue[o],d(h,h.statusText,h.status),t.working=!1,t.dispatch())},h}},{key:"disableUnloadListener",value:function(){window.removeEventListener("beforeunload",this.getIncompleteAlert)}},{key:"getIncompleteAlert",value:function(){return"You have items still processing.\nLeaving will discard unsent data.\nAre you sure you want to leave?"}}])&&o(t.prototype,c),p&&o(t,p),e}();return t=t.default}()}));